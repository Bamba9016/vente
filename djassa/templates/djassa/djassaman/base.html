<!DOCTYPE html>

<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>{% block titre %}{% endblock %}</title>
    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 56px 10px 0 10px; /* Top padding to avoid navbar overlap */
            box-sizing: border-box;
        }

       .navbar {
           position: fixed;
           top: 0;
           width: 100%;
           z-index: 1030;

       }
       .bottom-navbar {
           position: fixed;
           bottom: 0;
           width: 100%;
           z-index: 1030;
           display: none;
           background-color: #fff;
           border-top: 1px solid #ddd;
       }
       .bottom-navbar a {
           font-size: 1.2rem;
           padding: 10px;
           text-align: center;
           width: 100%;
       }
       .container {
           max-width: 800px;
       }
       @media (max-width: 768px) {
           .navbar {
               padding-bottom: 0;
           }
           .bottom-navbar {
               display: flex;
               justify-content: space-around;
           }
           body {
               padding-bottom: 56px; /* Adjust bottom padding for bottom navbar */
           }
           .navbar-brand {
               display: none; /* Hide logo on mobile */
           }
           .profile-img {
               width: 30px;
               height: 30px;
           }

           .post-card {
               margin-bottom: 15px; /* Réduit l'espacement */
           }

           .profile-header {
               padding: 10px;
           }

           .video-card video {
               height: 150px; /* Réduit la hauteur des vidéos */
           }

           .profile-info h2 {
               font-size: 1.2em; /* Réduit la taille du texte */
           }
       }

       .container {
           max-width: 800px; /* Center the content */
       }
       .post-card {
           margin-bottom: 20px; /* Reduced margin */
       }
       .profile-header {
           text-align: center;
           background-color: #eee ;
           padding: 20px;
           border-radius: 10px;
           top: 0;
           margin-bottom: 20px;
       }



       .profile-imgdiv {
           width: 40px;
           height: 40px;
           border-radius: 50%;
       }
       .profile-img {
           width: 80px;
           height: 80px;
           border-radius: 50%;
           object-fit: cover;
           border: 2px solid #ddd;
           margin-bottom: 10px;
           top: 100px;
       }
       .profile-info h2 {
           margin-bottom: 5px;
           font-size: 1.5em;
       }
       .profile-info p {
           color: gray;
           font-size: 0.9em;
       }
       .profile-stats {
           display: flex;
           justify-content: center;
           gap: 20px;
           margin-bottom: 15px;
       }
       .profile-stats button {
           border: none;
           background: none;
           font-weight: bold;
           font-size: 1.1em;
           cursor: pointer;
       }
       .profile-actions {
           margin-top: 15px;
       }
       .profile-actions .btn {
           font-size: 0.9em;
           margin: 0 5px;
       }
       .video-grid {
           display: grid;
           grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
           gap: 10px;
           margin-top: 20px;
       }
       .video-card {
           background-color: white;
           border-radius: 10px;
           overflow: hidden;
           box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
       }
       .video-card video {
           width: 100%;
           height: 200px;
           object-fit: cover;
       }
       .video-actions {
           padding: 10px;
           text-align: center;
       }
       .video-actions a {
           font-size: 1.2em;
           margin: 0 10px;
       }
       .friend-list {
           margin-top: 20px;
       }
       .friend-list ul {
           padding: 0;
           list-style: none;
       }
       .friend-list ul li {
           margin: 10px 0;
       }
       .friend-list ul li i {
           margin-right: 10px;
       }


    </style>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const inputs = document.querySelectorAll('#search-input');
    const resultsContainers = document.querySelectorAll('#search-results');

    inputs.forEach((input, index) => {
        const resultsContainer = resultsContainers[index]; // Match the result container

        input.addEventListener('input', function () {
            const query = this.value;

            if (query.length > 1) {
                fetch(`/ajax/recherche/?q=${query}`)
                    .then(response => response.json())
                    .then(data => {
                        resultsContainer.innerHTML = '';
                        let hasResults = false;

                        ['users', 'publications', 'demandes'].forEach(type => {
                            data[type].forEach(item => {
                                const li = document.createElement('a');
                                li.className = 'list-group-item list-group-item-action';
                                li.textContent = `${item.nom} (${item.type})`;
                                li.href = `/${item.type}/${item.id}/`;
                                resultsContainer.appendChild(li);
                                hasResults = true;
                            });
                        });

                        resultsContainer.style.display = hasResults ? 'block' : 'none';
                    });
            } else {
                resultsContainer.style.display = 'none';
            }
        });

        document.addEventListener('click', function (e) {
            if (!input.contains(e.target) && !resultsContainer.contains(e.target)) {
                resultsContainer.style.display = 'none';
            }
        });
    });
});


</script>


</head>
<body>

<header >
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">E-Commerce</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item {% block accueil %}{% endblock  %}">
                    <a class="nav-link" href="{% url 'accueil'  %}"><i class="fas fa-home"></i> Accueil</a>
                </li>
                <li class="nav-item {% block publication %}{% endblock  %}">
                    <a class="nav-link" href="{% url 'publication'  %}"><i class="fas fa-th-list"></i> Publications</a>
                </li>
                <li class="nav-item {% block vente %}{% endblock  %}">
                    <a class="nav-link" href="{% url 'page_de_vente'  %}"><i class="fas fa-shopping-cart"></i> Vente</a>
                </li>
                <li class="nav-item {% block message %}{% endblock  %}">
                    <a class="nav-link" href="{% url 'inbox' %}"><i class="fas fa-comments"></i> Messagerie</a>
                </li>

            </ul>
            <form class="form-inline my-2 my-lg-0 " action="{% url 'recherche_resultats' %}" method="get">
                <div class="d-flex">
    <div class="position-relative" style="width: 100%;">
        <input class="form-control mr-sm-2" id="search-input" type="search" name="q" placeholder="Recherche..." autocomplete="off">
        <div id="search-results" class="list-group position-absolute" style="z-index: 1000; width: 100%; display: none;"></div>
    </div>
    <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Rechercher</button></div>
</form>
            <div class="dropdown ml-3">
                <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="profileDropdown"
                   role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    {% if request.user.profile_picture %}
                        <img src="{{ request.user.profile_picture.url }}" alt="Profile Image" class="profile-imgdiv">
                    {% else %}
                        <img src="https://placehold.co/120x120" alt="Profile Image"
                         class="profile-imgdiv">
                    {% endif %}
                    <span class="ml-2">{{ user.first_name }} {{ user.last_name }}</span>
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="profileDropdown">
                    <a class="dropdown-item" href="{% url 'profile'  %}"><i class="fas fa-user"></i> Mon Profil</a>
                    <a class="dropdown-item" href="{% url 'parametres' %}"><i class="fas fa-cogs"></i> Paramètres</a>
                    <a class="dropdown-item" href="{% url 'notifications' %}"><i class="fas fa-bell"></i> Notifications
                    {% if unread_count > 0 %}
                        <span class="notification-badge">
                            {{ unread_count }}
                        </span>
                    {% endif %}
                </a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="{% url 'logout' %}"><i class="fas fa-sign-out-alt"></i>
                        Déconnexion</a>
                </div>
            </div>
        </div>
    </nav>


    <!-- Fixed top section for mobile (logo, search, profile) -->
    <nav class="navbar navbar-light bg-light d-block d-lg-none">
        <div class="d-flex justify-content-between w-100">
            <a href="{% url 'inbox' %}" class="nav-link"><i class="fas fa-comments"></i></a>
            <form class="form-inline" action="{% url 'recherche_resultats' %}" method="get">
    <div class="position-relative w-100">
        <input class="form-control mr-sm-2" id="search-input" type="search" name="q" placeholder="Recherche..." autocomplete="off">
        <div id="search-results" class="list-group position-absolute" style="z-index: 1000; width: 100%; display: none;"></div>
    </div>
</form>

            <div class="dropdown ml-3">
                <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="profileDropdown"
                   role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    {% if request.user.profile_picture %}
                        <img src="{{ request.user.profile_picture.url }}" alt="Profile Image" class="profile-imgdiv">
                    {% else %}
                        <img src="https://placehold.co/120x120" alt="Profile Image"
                         class="profile-imgdiv">
                    {% endif %}
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="profileDropdown">
                    <a class="dropdown-item" href="{% url 'profile'  %}"><i class="fas fa-user"></i> Mon Profil</a>
                    <a class="dropdown-item" href="{% url 'parametres' %}"><i class="fas fa-cogs"></i> Paramètres</a>
                    <a class="dropdown-item" href="{% url 'notifications' %}"><i class="fas fa-bell"></i> Notifications
                    {% if unread_count > 0 %}
                        <span class="notification-badge">
                            {{ unread_count }}
                        </span>
                    {% endif %}
                </a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="{% url 'logout' %}"><i class="fas fa-sign-out-alt"></i>
                        Déconnexion</a>
                </div>
            </div>
        </div>
    </nav>
</header>


 <section id="acontent">  <!-- Ajout de l'ID content ici -->
        {% block content %}{% endblock %}
 </section>

<!-- Bottom navbar for mobile -->
<nav class="bottom-navbar d-lg-none">
    <a href="{% url 'accueil'  %}" class="nav-link"><i class="fas fa-home"></i></a>
    <a href="{% url 'publication'  %}" class="nav-link"><i class="fas fa-th-list"></i></a>
    <a href="{% url 'page_de_vente'  %}" class="nav-link"><i class="fas fa-shopping-cart"></i></a>
    <a href="{% url 'inbox' %}" class="nav-link"><i class="fas fa-comments"></i></a>
    <a href="#" class="nav-link"><i class="fas fa-bell"></i></a>
</nav>


<!-- Bootstrap JS and dependencies -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>





<script>
document.addEventListener('DOMContentLoaded', function () {
    // Gestion navigation AJAX
    document.addEventListener('click', function (e) {
        const link = e.target.closest('a');
        if (!link || e.defaultPrevented) return;

        // Ignorer les liens externes, les ancres, ou ceux avec data-ignore-spa
        if (
            link.href.indexOf(window.location.origin) === -1 ||
            link.href.includes('#') ||
            link.target === '_blank' ||
            link.hasAttribute('data-ignore-spa')
        ) {
            return;
        }

        e.preventDefault();
        history.pushState(null, null, link.href);
        loadContent(link.href);
    });

    // Gérer les retours/arrière du navigateur
    window.addEventListener('popstate', function () {
        loadContent(window.location.href);
    });

    // Chargement initial si nécessaire
    // loadContent(window.location.href);
});

// Fonction pour charger dynamiquement le contenu
function loadContent(url) {
    const path = new URL(url).pathname;
    const contentContainer = document.getElementById('acontent');

    // Affiche un spinner pendant le chargement
    contentContainer.innerHTML = '<div class="text-center py-5"><i class="fas fa-spinner fa-spin fa-3x"></i></div>';

    fetch(path, {
        headers: { 'X-Requested-With': 'XMLHttpRequest' }
    })
    .then(response => {
        if (!response.ok) throw new Error("HTTP error " + response.status);
        return response.text();
    })
    .then(html => {
        // Parse le HTML et extrait les scripts
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const newContent = doc.getElementById('acontent');
        if (newContent) {
            contentContainer.innerHTML = newContent.innerHTML;

            // Recharge les <script> inclus dans le nouveau contenu
            const scripts = newContent.querySelectorAll('script');
            scripts.forEach(oldScript => {
                const newScript = document.createElement('script');
                if (oldScript.src) {
                    newScript.src = oldScript.src;
                } else {
                    newScript.textContent = oldScript.textContent;
                }
                document.body.appendChild(newScript);
                oldScript.remove(); // optionnel
            });

            window.scrollTo(0, 0);
        } else {
            window.location.href = url; // fallback si erreur
        }
    })
    .catch(error => {
        console.error('Erreur AJAX:', error);
        window.location.href = url;
    });
}
</script>



</body>
</html>
